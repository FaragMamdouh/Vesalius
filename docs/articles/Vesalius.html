<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vesalius: Quick Start • vesalius</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vesalius: Quick Start">
<meta property="og:description" content="vesalius">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vesalius</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vesalius.html">Vesalius: Quick Start</a>
    </li>
    <li>
      <a href="../articles/Vesalius_Analysis/Vesalius_analysis.html">Vesalius Manuscript Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/patrickCNMartin/Vesalius/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Vesalius_files/header-attrs-2.11/header-attrs.js"></script><script src="Vesalius_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Vesalius: Quick Start</h1>
                        <h4 data-toc-skip class="author">Patrick C.N. Martin</h4>
            
            <h4 data-toc-skip class="date">2021-10-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/patrickCNMartin/Vesalius/blob/main/vignettes/Vesalius.Rmd" class="external-link"><code>vignettes/Vesalius.Rmd</code></a></small>
      <div class="hidden name"><code>Vesalius.Rmd</code></div>

    </div>

    
    
<div id="vesalius-quick-start" class="section level1">
<h1 class="hasAnchor">
<a href="#vesalius-quick-start" class="anchor" aria-hidden="true"></a>Vesalius: Quick Start</h1>
<p>Do you like to live in the fast lane? Do you sigh every time you see a long vignette? Do you wish there was a TLDR on everything?</p>
<p>I understand.</p>
<p>Welcome to the Vesalius quick start!</p>
<p>In this vignette, you will find a <strong>very</strong> short guide on how to work with Vesalius. Vesalius provides an internal data set taken from real Spatial transcrtiptomic data. For an in depth view of Vesalius, please refer to Vesalius_Analysis.Rmd.</p>
<p>For all intents and purposes, this is a dummy data set and should only be used to get a feel for the Vesalius package. We strongly advise you to use real and complete data sets to fully understand the Vesalius package and its benefits.</p>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h1>
<p>Vesalius is a tool to perform high-resolution in silico anatomization and molecular characterization from ST data without requiring companion images.</p>
<p>This is achieved by converting ST data into images: PCA loading values are embedded into RGB colour channels by taking the sum of the absolute value of all loading values associated to each bead on the ST array.</p>
<p>Image analysis techniques are applied to the image and anatomical territories can subsequently be extracted.</p>
</div>
<div id="loading" class="section level1">
<h1 class="hasAnchor">
<a href="#loading" class="anchor" aria-hidden="true"></a>Loading</h1>
<p>First, let’s load the package and the data. Data originates from slide-seqV2 data (availble at (Single Cell Portal)[<a href="https://singlecell.broadinstitute.org/single_cell/study/SCP948/robust-decomposition-of-cell-type-mixtures-in-spatial-transcriptomics#study-download" class="external-link uri">https://singlecell.broadinstitute.org/single_cell/study/SCP948/robust-decomposition-of-cell-type-mixtures-in-spatial-transcriptomics#study-download</a>]).</p>
<p>For sake of simplicity, Vesalius takes a small subset of this data set and stores it in the form of a Seurat object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patrickcnmartin.github.io/Vesalius/">vesalius</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: replacing previous import 'imager::fill' by 'tidyr::fill' when loading
## 'vesalius'</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vesalius</span>,package <span class="op">=</span> <span class="st">"vesalius"</span><span class="op">)</span>
<span class="co"># First create a copy of raw data for later use</span>
<span class="co"># For sake of simplicity we seperate counts from Vesalius images.</span>
<span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">vesalius</span></code></pre></div>
</div>
<div id="pre-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#pre-processing" class="anchor" aria-hidden="true"></a>Pre-processing</h1>
<p>Second, we pre-process the data using Seurat</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Preprocessing Spatial transcriptomic data with Seurat</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">vesalius</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">vesalius</span>, nfeatures <span class="op">=</span> <span class="fl">2000</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">vesalius</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
<div id="emedding-into-rgb-colour-space" class="section level1">
<h1 class="hasAnchor">
<a href="#emedding-into-rgb-colour-space" class="anchor" aria-hidden="true"></a>Emedding into RGB colour Space</h1>
<p>Third, we convert a count matrix (stored in a Seurat object) to RGB coded coordinates. We will only produce one slice (i.e. PC1 to PC3). Alternatively, you can also choose to embed UMAP projections. In this case, there are no slices but only a number of Principal Components used for UMAP.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># PCA</span>
<span class="va">vesaliusPCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgbPCA.html">rgbPCA</a></span><span class="op">(</span><span class="va">vesalius</span>,slices <span class="op">=</span> <span class="fl">1</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span>

<span class="co"># UMAP</span>
<span class="va">vesaliusUMAP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgbUMAP.html">rgbUMAP</a></span><span class="op">(</span><span class="va">vesalius</span>,pcs <span class="op">=</span> <span class="fl">30</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric
## To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'
## This message will be shown once per session</code></pre>
</div>
<div id="building-an-image" class="section level1">
<h1 class="hasAnchor">
<a href="#building-an-image" class="anchor" aria-hidden="true"></a>Building an Image</h1>
<p>Forth, we create an actual image by using a combination of Voronoi diagrams and tile rasterisation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildImageArray.html">buildImageArray</a></span><span class="op">(</span><span class="va">vesaliusPCA</span>, sliceID <span class="op">=</span> <span class="fl">1</span>, invert <span class="op">=</span><span class="cn">T</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span>


<span class="co"># Let's have a look shall we?</span>
<span class="va">Vesalius_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imagePlot.html">imagePlot</a></span><span class="op">(</span><span class="va">vesalius</span>,as.cimg <span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Vesalius_image</span><span class="op">)</span></code></pre></div>
<p><img src="Vesalius_files/figure-html/buildImage-1.png" width="576"></p>
</div>
<div id="applying-image-analysis-techniques" class="section level1">
<h1 class="hasAnchor">
<a href="#applying-image-analysis-techniques" class="anchor" aria-hidden="true"></a>Applying Image Analysis techniques</h1>
<p>Firth, we can apply image analysis techniques such as histogram equalisation, variance regularisation, smoothing and segmentation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Histogram EQ</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equalizeHistogram.html">equalizeHistogram</a></span><span class="op">(</span><span class="va">vesalius</span>,sleft <span class="op">=</span> <span class="fl">2.5</span>, sright<span class="op">=</span><span class="fl">2.5</span>,invert <span class="op">=</span><span class="cn">T</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## 2021-10-28 15:50:09  Inverting Colours</code></pre>
<pre><code>## Warning in as.cimg.data.frame(.): Guessing image dimensions from maximum
## coordinate values

## Warning in as.cimg.data.frame(.): Guessing image dimensions from maximum
## coordinate values</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Variance regularisation</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regulariseImage.html">regulariseImage</a></span><span class="op">(</span><span class="va">vesalius</span>, lambda <span class="op">=</span> <span class="fl">10</span>,
                            niter <span class="op">=</span> <span class="fl">200</span>, normalise<span class="op">=</span><span class="cn">T</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in as.cimg.data.frame(.): Guessing image dimensions from maximum
## coordinate values</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Smoothing</span>
<span class="co"># !!!Optional!!! -</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smoothArray.html">smoothArray</a></span><span class="op">(</span><span class="va">vesalius</span>,method <span class="op">=</span> <span class="st">"box"</span>, box <span class="op">=</span> <span class="fl">1</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in as.cimg.data.frame(select(image, c("x", "y", "cc", "value"))):
## Guessing image dimensions from maximum coordinate values</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Segmentation</span>
<span class="co"># This function provides smoothing internally.</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterativeSegmentation.array.html">iterativeSegmentation.array</a></span><span class="op">(</span><span class="va">vesalius</span>,
                                        colDepth <span class="op">=</span> <span class="fl">6</span>,
                                        smoothIter <span class="op">=</span> <span class="fl">20</span>,
                                        method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso"</span>,<span class="st">"median"</span><span class="op">)</span>,
                                        sigma<span class="op">=</span><span class="fl">1.5</span>,
                                        box <span class="op">=</span> <span class="fl">10</span>,
                                        useCenter <span class="op">=</span> <span class="cn">T</span>,
                                        invert <span class="op">=</span><span class="cn">T</span>,
                                        verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in as.cimg.data.frame(select(image, c("x", "y", "cc", "value"))):
## Guessing image dimensions from maximum coordinate values

## Warning in as.cimg.data.frame(select(image, c("x", "y", "cc", "value"))):
## Guessing image dimensions from maximum coordinate values</code></pre>
<pre><code>## Warning in as.cimg.data.frame(imgCopy): Guessing image dimensions from maximum
## coordinate values</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Isolating territories from colour segments</span>
<span class="va">vesalius</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/isolateTerritories.array.html">isolateTerritories.array</a></span><span class="op">(</span><span class="va">vesalius</span>,
                                     captureRadius <span class="op">=</span> <span class="fl">0.1</span>,
                                     minBar <span class="op">=</span> <span class="fl">10</span>,
                                     verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
<div id="visualisation" class="section level1">
<h1 class="hasAnchor">
<a href="#visualisation" class="anchor" aria-hidden="true"></a>Visualisation</h1>
<p>Sixth, we can visualise the territories.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's have a look!</span>
<span class="va">imgTerritory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/territoryPlot.html">territoryPlot</a></span><span class="op">(</span><span class="va">vesalius</span>, randomise <span class="op">=</span> <span class="cn">TRUE</span>,cex <span class="op">=</span><span class="fl">15</span> , cex.pt<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">imgTerritory</span><span class="op">)</span></code></pre></div>
<p><img src="Vesalius_files/figure-html/viz-1.png" width="576"></p>
</div>
<div id="territory-extraction-and-markers" class="section level1">
<h1 class="hasAnchor">
<a href="#territory-extraction-and-markers" class="anchor" aria-hidden="true"></a>Territory extraction and markers</h1>
<p>Finally, we can extract territories to run a more in depth analysis. This returns a Seurat object with all selected territories. We can also find differential gene expression between territories.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract terriotry from seurat object</span>
<span class="va">ter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractTerritories.html">extractTerritories</a></span><span class="op">(</span><span class="va">vesalius</span>,<span class="va">counts</span>,seedID<span class="op">=</span> <span class="fl">1</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in as.cimg.data.frame(.): Guessing image dimensions from maximum
## coordinate values</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get all markers related to all territories</span>
<span class="va">all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractAllMarkers.html">extractAllMarkers</a></span><span class="op">(</span><span class="va">vesalius</span>,<span class="va">counts</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span>


<span class="co"># get markers associated with on or more territories</span>
<span class="va">one</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractMarkers.html">extractMarkers</a></span><span class="op">(</span><span class="va">vesalius</span>, <span class="va">counts</span>, seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># comparing territories</span>
<span class="va">two</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractMarkers.html">extractMarkers</a></span><span class="op">(</span><span class="va">vesalius</span>, <span class="va">counts</span>, seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,verbose <span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Patrick C.N. Martin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
